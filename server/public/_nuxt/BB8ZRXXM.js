import{_ as C}from"./CyY3lptK.js";import{bI as v,f as u,E as b}from"./Cr5Ubhxi.js";import{E as B}from"./BtaPwG8Q.js";import"./DJju3RTy.js";import{r as d,a as M,b as I}from"./Dl-E1xuV.js";import{l as P,b as S,m as T,M as m,a0 as p,a1 as i,V as k,a6 as F,ag as U}from"./BgewwvAi.js";const z=100*1024*1024,N=P({__name:"upload-button",props:{type:{},multiple:{type:Boolean},isParseContent:{type:Boolean},isOnlyParseContent:{type:Boolean}},emits:["on-success","on-failed"],setup(f,{emit:y}){const l={file:"*/*",image:"image/*",video:"video/*",audio:"audio/*"},a=f,c=y,o=S(!1),g=T(()=>l[a.type]??l.file);function _(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}async function w(e){try{if(e.file.size>z)throw new Error("文件大小不能超过100MB");return o.value=!0,a.isOnlyParseContent?{id:_().toString(),uri:"",type:0,name:e.file.name}:await v(a.type,{file:e.file,name:"file"})}catch(t){u.msgError(t instanceof Error?t.message:"上传失败")}finally{o.value=!1}}async function E(e,t){const n={id:e.id,url:e.uri,type:e.type,name:e.name,size:t.size,text:""};try{o.value=!0,(a.isParseContent||a.isOnlyParseContent)&&(n.text=await x(t.raw))}catch(s){const r=s instanceof Error?s.message:"文件解析错误";u.msgError(r)}finally{o.value=!1}c("on-success",n)}const x=async e=>{switch(e.name.split(".").pop()){case"md":case"txt":return await d(e);case"pdf":return await I(e);case"doc":case"docx":return await M(e);default:return await d(e)}};return(e,t)=>{const n=C,s=b,r=B;return m(),p(r,{ref:"uploadRef","show-file-list":!1,accept:g.value,multiple:a.multiple,"on-success":E,"http-request":w,"on-error":h=>c("on-failed",h)},{trigger:i(()=>[e.$slots.default?k(e.$slots,"default",{key:0,isLoading:o.value}):(m(),p(s,{key:1,plain:"",class:"!rounded-[8px]",loading:o.value},{icon:i(()=>[F(n,{name:"el-icon-Upload"})]),default:i(()=>[t[0]||(t[0]=U(" 上传文件 "))]),_:1},8,["loading"]))]),_:3},8,["accept","multiple","on-error"])}}});export{N as _};
