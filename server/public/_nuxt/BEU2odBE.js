import{_ as ce}from"./CGGYEFhd.js";import{_ as pe}from"./DdlVXt-l.js";import{a as me,b as fe,j as ve,l as ge,cH as ye,$ as he,_ as _e,f as E}from"./Cr5Ubhxi.js";import{u as R}from"./BflNLQ2W.js";import{u as xe}from"./CX-Jc4Wd.js";import we from"./DPiFOWN4.js";import{C as Se,a as Ce}from"./DzO3HwGH.js";import Ie from"./DoNlcEeC.js";import{b as be,e as Le,c as ke}from"./DQUFgXGm.js";import{g as Ee,a as Re,b as Me}from"./BdjxQtGL.js";import{u as De}from"./CLsHMAv6.js";import{c as H}from"./BWU-kwnx.js";import{l as $e,b as v,j as ze,q as Ne,r as J,ai as M,c as O,k as Ve,M as D,N as $,a6 as S,a1 as K,O as g,_ as X,ao as Ue,$ as qe,u as n,a3 as Fe,Z as Te,y as z,n as Ae}from"./BgewwvAi.js";import{_ as He}from"./DlAUqK2U.js";import"./Dua6tcUZ.js";import"./lylAQj0-.js";import"./DCTLXrZ8.js";import"./B-UECF4z.js";import"./WwjzPWiF.js";import"./B8eVAIGV.js";import"./CvX1p1Zl.js";import"./lURfvm38.js";import"./DkD6xkHx.js";import"./BxqZsOx6.js";import"./CthRtmCg.js";import"./HhgPgBuu.js";import"./CyY3lptK.js";import"./Ct9hkhkX.js";import"./BqfsOZFw.js";/* empty css        *//* empty css        *//* empty css        *//* empty css        */import"./CSNrKBDo.js";import"./Cp1klw-J.js";import"./vqJmiX2Z.js";/* empty css        */import"./DIG9jm1d.js";import"./DSuzuHr1.js";import"./liHltn2h.js";import"./DP2rzg_V.js";/* empty css        */import"./BMbyqd4v.js";/* empty css        */import"./CLdqNFDZ.js";import"./C1HvARKU.js";import"./BzAs22Q4.js";import"./BtWRx-QN.js";import"./BNDteuJm.js";import"./BBbnqW98.js";import"./l0sNRNKZ.js";import"./DjYdeApN.js";import"./BamfvPxi.js";import"./BN2uy5AJ.js";import"./Ca-AvAta.js";import"./C91Hnkfk.js";import"./DP9ejo7Y.js";import"./BBYJlS94.js";import"./DLQfD3Uz.js";/* empty css        */const Y=(x,a="yyyy-mm-dd")=>{x||(x=Number(new Date)),x.toString().length===10&&(x*=1e3);const d=new Date(x);let f;const w={"y+":d.getFullYear().toString(),"m+":(d.getMonth()+1).toString(),"d+":d.getDate().toString(),"h+":d.getHours().toString(),"M+":d.getMinutes().toString(),"s+":d.getSeconds().toString()};for(const y in w)f=new RegExp(`(${y})`).exec(a),f&&(a=a.replace(f[1],f[1].length===1?w[y]:w[y].padStart(f[1].length,"0")));return a},Oe={class:"flex flex-col h-full"},Ke={class:"px-[16px] pt-[16px] round-[12px]"},je={class:"flex flex-wrap gap-y-2 my-swiper category-lists"},Be=["onClick"],Pe={class:"flex-1 min-h-0 flex"},Ze={class:"py-[16px] pl-[16px]"},Ge={class:"flex-1 min-w-0 p-4"},Je={class:"h-full flex bg-body rounded-[12px]"},Xe={class:"h-full border-r border-solid border-br-light"},Ye={class:"flex-1 min-w-0"},Qe=$e({__name:"produce",async setup(x){let a,d;const f=v(""),w=me();De();const y=v(!0),j=v([]),u=v({}),N=fe(),Q=ve(),V=ge(),{cateId:W,modelId:ee}=w.query,C=v("current"),I=ze({});Ne("chatModel",I);const i=J({cateId:W||"0",modelId:ee,modelKey:""}),te=async e=>{i.cateId=e,await B();const[t]=T.value||[];V.replace({path:"",query:{cateId:e,modelId:t==null?void 0:t.id}})},{data:U,pending:We,refresh:et}=([a,d]=M(()=>R(()=>Ee(),{default(){return[]},lazy:!0},"$3iMOmfmgi4")),a=await a,d(),a);v(!1),v(0);let q=null;const F=e=>{try{q==null||q.slideTo(e)}catch(t){console.error(t)}},{data:T,refresh:B}=([a,d]=M(()=>R(()=>Re({keyword:f.value,category_id:i.cateId,page_size:999}),{lazy:!0},"$VSSSR0UZJy")),a=await a,d(),a);ye(f,e=>{B()},{debounce:500});const oe=async()=>{await E.confirm("确定清空创作记录？"),await Le({type:2,other_id:i.modelId}),l.value=[],L()},{data:b,refresh:ae}=([a,d]=M(()=>R(()=>Me({id:i.modelId}),{default(){return{}},transform(e){return e},lazy:!0},"$dzxelPzSXF")),a=await a,d(),a),c=J({pageNo:1,count:0,pageSize:15,lists:[]}),{refresh:A,pending:re}=([a,d]=M(()=>R(()=>be({other_id:i.modelId||0,page_size:c.pageSize,page_no:c.pageNo,type:2}),{default(){return[]},transform(e){c.count=e.count;const t=e.lists.map(s=>{let p="";if(he(s.ask)){const _=(s==null?void 0:s.ask[0])||{};p=`${_.title}：${_.value}`}else p=s.ask;return{...s,title:p}});return c.pageNo===1&&(c.lists=[]),c.lists.push(...t),t},lazy:!0},"$T4LGrdB7sx")),a=await a,d(),a),L=async()=>{Object.assign(c,{pageNo:1,count:0,pageSize:15,lists:[]}),await A()},le=()=>{re.value||c.count>=c.pageNo*c.pageSize&&(c.pageNo++,A())},ne=e=>{console.log("model",e),i.modelId=e.id,L()},{lockFn:se}=xe(async e=>{e.extra&&(u.value=e.extra,await Ae(),Z())}),ie=()=>{var e,t;(t=(e=b.value)==null?void 0:e.form)==null||t.forEach(s=>{s.props.placeholder&&!s.props.defaultValue&&(u.value[s.props.field]=s.props.placeholder)})},de=()=>{var e;(e=b.value)==null||e.form.forEach(t=>{t.props.defaultValue?u.value[t.props.field]=H(t.props.defaultValue):u.value[t.props.field]=void 0})},ue=()=>{y.value?(y.value=!1,j.value=[]):(j.value=U.value.map(e=>e.id),y.value=!0)},l=v([]),P=()=>{var t;const e=((t=b.value)==null?void 0:t.form[0])||{};return`${e.props.title}：${u.value[e.props.field]||""}`},h=v(!1);let r;const Z=async()=>{if(!h.value){C.value="current",h.value=!0,l.value=[],F(1);try{r=ke({other_id:i.modelId,question:u.value,type:2,creation_type:Ce.Normal,model:i.modelKey}),r.addEventListener("close",async()=>{Q.getUser(),setTimeout(async()=>{h.value=!1,await L();const e=l.value.length;l.value[e-1].id=c.lists[0].id},200)}),r.addEventListener("error",async e=>{var t;if(((t=e.data)==null?void 0:t.code)===1100){N.getIsShowRecharge?(await E.confirm(`${N.getTokenUnit}数量已用完，请前往充值`),V.push("/user/recharge")):E.msgError(`${N.getTokenUnit}数量已用完。请联系客服增加`);return}e.errorType==="connectError"&&E.msgError("请求失败，请重试"),setTimeout(()=>{h.value=!1,F(0)},200)}),r.addEventListener("reasoning",({data:e})=>{const{id:t,event:s,data:p,code:_,index:m}=e;let o=l.value.findIndex(k=>k.id===t);o===-1&&(l.value.push({create_time:Y(Date.now(),"yyyy-mm-dd hh:MM:ss"),title:u.value.question?u.value.question:P(),reply:[],extra:H(u.value),id:t}),o=l.value.length-1),p&&(l.value[o].reply[m]||(l.value[o].reply[m]=""),l.value[o].reply[m]+=p)}),r.addEventListener("chat",({data:e})=>{const{id:t,event:s,data:p,code:_,index:m}=e;let o=l.value.findIndex(k=>k.id===t);o===-1&&(l.value.push({create_time:Y(Date.now(),"yyyy-mm-dd hh:MM:ss"),title:u.value.question?u.value.question:P(),reply:[],extra:H(u.value),id:t}),o=l.value.length-1),p&&(l.value[o].reply[m]||(l.value[o].reply[m]=""),l.value[o].reply[m]+=p)}),r.addEventListener("finish",({data:e})=>{const{data:t,index:s,id:p}=e,_=l.value.findIndex(m=>m.id===p);t&&(l.value[_].reply[s]+=t),de()})}catch{h.value=!1}}};O(U,e=>{y.value=!1,ue()},{immediate:!0});const G=()=>{r==null||r.removeEventListener("close"),r==null||r.removeEventListener("chat"),r==null||r.removeEventListener("error"),r==null||r.removeEventListener("finish"),r==null||r.abort(),h.value=!1};return O(()=>w.query,({cateId:e,modelId:t})=>{i.cateId=e,i.modelId=t,l.value=[],C.value="current",F(0),G(),t?(ae(),L()):b.value={}}),O(()=>T.value,e=>{e.length&&i.modelId==null&&V.replace({path:"",query:{cateId:i.cateId,modelId:e[0].id}})},{deep:!0}),Ve(()=>{G()}),(e,t)=>{const s=ce,p=pe,_=_e;return D(),$("div",null,[S(_,{name:"default"},{default:K(()=>{var m;return[g("div",Oe,[g("div",Ke,[g("div",je,[(D(!0),$(X,null,Ue(n(U),(o,k)=>(D(),$(X,null,[Object.keys(o).includes("name")?(D(),$("div",{key:0,class:qe(["category-item",{"is-active":n(i).cateId==o.id}]),onClick:tt=>te(o.id)},Fe(o.name),11,Be)):Te("",!0)],64))),256))])]),g("div",Pe,[g("div",Ze,[S(Ie,{modelValue:n(f),"onUpdate:modelValue":t[0]||(t[0]=o=>z(f)?f.value=o:null),"model-state":n(i),"current-model-list":((m=n(T))==null?void 0:m.lists)||[],onSelect:ne},null,8,["modelValue","model-state","current-model-list"])]),g("div",Ge,[g("div",Je,[g("div",Xe,[S(we,{modelValue:n(u),"onUpdate:modelValue":t[3]||(t[3]=o=>z(u)?u.value=o:null),class:"h-full 2xl:w-[400px] xl:w-[350px] lg:w-[320px] w-[250px]","model-data":n(b),loading:n(h),onInsert:ie,onCreate:Z},{actions:K(()=>[S(s,{class:"w-full my-[10px]",sub_id:n(i).modelKey,"onUpdate:sub_id":t[1]||(t[1]=o=>n(i).modelKey=o),modelConfig:n(I),"onUpdate:modelConfig":t[2]||(t[2]=o=>z(I)?I.value=o:null)},null,8,["sub_id","modelConfig"])]),_:1},8,["modelValue","model-data","loading"])]),g("div",Ye,[S(p,null,{default:K(()=>[S(Se,{current:n(C),"onUpdate:current":t[4]||(t[4]=o=>z(C)?C.value=o:null),chatModel:n(I),"current-creation-history":n(l),loading:n(h),"page-info":n(c),onLoad:le,onClean:oe,onRewrite:n(se),onRefresh:n(A)},null,8,["current","chatModel","current-creation-history","loading","page-info","onRewrite","onRefresh"])]),_:1})])])])])])]}),_:1})])}}}),io=He(Qe,[["__scopeId","data-v-c15da807"]]);export{io as default};
